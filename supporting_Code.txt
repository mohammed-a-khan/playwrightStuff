// src/support/hooks.ts
import { Before, After, BeforeStep, AfterStep, setDefaultTimeout } from '@cucumber/cucumber';
import { chromium, Browser } from '@playwright/test';
import { TestContext } from './test-context';
import { Logger } from '../framework/utils/logger';
import { ConfigManager } from '../framework/utils/config-manager';

// Before all scenarios
Before(async function(this: TestContext, scenario) {
  const config = ConfigManager.getInstance();
  
  // Create a unique test ID based on scenario name and timestamp
  const testId = `${scenario.pickle.name.replace(/[^a-zA-Z0-9]/g, '-')}-${Date.now()}`;
  
  // Initialize logger with test ID
  this.logger = new Logger(testId);
  this.logger.setScenario(scenario.pickle.name);
  
  // Log environment information
  this.logger.info(`Running tests in ${config.getEnvironment().toUpperCase()} environment`);
  
  // For UI tests, initialize browser
  if (scenario.pickle.tags.some(tag => tag.name === '@web' || tag.name === '@ui')) {
    // Launch browser if not already launched
    if (!browser) {
      this.logger.info('Launching browser');
      const browserConfig = config.getBrowserConfig();
      browser = await chromium.launch({
        headless: browserConfig.headless,
        slowMo: browserConfig.slowMo,
        args: browserConfig.args
      });
    }
    
    // Rest of browser initialization
  }
}
