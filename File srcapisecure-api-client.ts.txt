package com.mycompany.listeners;

import com.qmetry.qaf.automation.keys.ApplicationProperties;
import com.qmetry.qaf.automation.step.QAFTestStepListener;
import io.restassured.RestAssured;
import io.restassured.config.SSLConfig;
import java.io.File;

public class SSLInitializationListener implements QAFTestStepListener {

    @Override
    public void onExecutionStart() {
        // Initialize SSL settings when execution starts
        try {
            String certPath = ApplicationProperties.RESOURCES_DIR.getStringVal() + 
                           "/certificates/KHANonProd.pfx";
            String certPassword = "kha#123!";
            
            File certFile = new File(certPath);
            System.out.println("Certificate file exists: " + certFile.exists());
            
            RestAssured.config = RestAssured.config()
                .sslConfig(new SSLConfig()
                    .keyStore(certFile, certPassword)
                    .trustStore(certFile, certPassword)
                    .relaxedHTTPSValidation());
                    
            System.out.println("SSL configuration initialized by listener");
        } catch (Exception e) {
            System.err.println("Error initializing SSL: " + e.getMessage());
            e.printStackTrace();
        }
    }

    // Implement other required methods
    @Override
    public void onExecutionFinish() { }
    
    @Override
    public void beforStepExecute(StepExecutionTracker tracker) { }
    
    @Override
    public void afterStepExecute(StepExecutionTracker tracker) { }
}
